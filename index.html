<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex Legends éš¨æ©ŸæŠ½é¸å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #7f1d1d 0%, #dc2626 50%, #7f1d1d 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            color: white;
            margin-bottom: 10px;
            text-shadow: 
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000,
                2px 2px 0 #000,
                0 0 20px rgba(0, 0, 0, 0.8);
            letter-spacing: 2px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .btn-settings {
            background: #9333ea;
            color: white;
            margin-bottom: 20px;
        }

        .btn-settings:hover {
            background: #7e22ce;
        }

        .btn-spin {
            background: linear-gradient(to right, #f97316, #dc2626);
            color: white;
            font-size: 1.5rem;
            padding: 16px 48px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0 auto 30px;
        }

        .btn-spin:hover:not(:disabled) {
            background: linear-gradient(to right, #ea580c, #b91c1c);
        }

        .btn-spin:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }

        .settings-panel {
            background: #1e293b;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .settings-section {
            margin-bottom: 24px;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .settings-header h2 {
            color: white;
            font-size: 1.5rem;
        }

        .btn-group button {
            padding: 6px 12px;
            margin-left: 8px;
            font-size: 14px;
        }

        .btn-select-all {
            background: #16a34a;
            color: white;
        }

        .btn-select-all:hover {
            background: #15803d;
        }

        .btn-deselect-all {
            background: #dc2626;
            color: white;
        }

        .btn-deselect-all:hover {
            background: #b91c1c;
        }

        .role-group {
            margin-bottom: 16px;
        }

        .role-title {
            color: #d8b4fe;
            font-size: 1.1rem;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }

        .item-card {
            background: #334155;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            opacity: 0.4;
        }

        .item-card.enabled {
            background: #9333ea;
            border-color: #c084fc;
            opacity: 1;
        }

        .item-card img {
            width: 100%;
            height: 80px;
            object-fit: contain;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .weapon-card img {
            object-fit: contain;
            height: 60px;
        }

        .item-card p {
            color: white;
            font-size: 0.75rem;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .results {
                grid-template-columns: 1fr;
            }
        }

        .result-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .result-card h3 {
            font-size: 1.5rem;
            margin-bottom: 16px;
        }

        .result-card.legend h3 {
            color: #d8b4fe;
        }

        .result-card.weapon h3 {
            color: #fdba74;
        }

        .result-display {
            transition: all 0.3s;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .result-display.spinning {
            transform: scale(1.05);
        }

        .result-display img {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .result-card.legend .result-display img {
            height: 280px;
            object-fit: contain;
        }

        .result-card.weapon .result-display img {
            height: 280px;
            object-fit: contain;
        }

        .result-display p {
            color: white;
            font-size: 1.25rem;
            font-weight: bold;
        }

        .placeholder {
            width: 100%;
            background: #334155;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            height: 280px;
        }

        .center {
            display: flex;
            justify-content: center;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinning-icon {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œ -->
        <div class="header">
            <h1>Apex Legends</h1>
        </div>

        <!-- è¨­å®šæŒ‰éˆ• -->
        <div class="center">
            <button class="btn btn-settings" onclick="toggleSettings()">
                âš™ï¸ <span id="settingsText">é–‹å•Ÿè¨­å®š</span>
            </button>
        </div>

        <!-- è¨­å®šé¢æ¿ -->
        <div id="settingsPanel" class="settings-panel">
            <!-- è‹±é›„é¸æ“‡ -->
            <div class="settings-section">
                <div class="settings-header">
                    <h2>é¸æ“‡è‹±é›„</h2>
                    <div class="btn-group">
                        <button class="btn btn-select-all" onclick="selectAllLegends(true)">å…¨é¸</button>
                        <button class="btn btn-deselect-all" onclick="selectAllLegends(false)">å–æ¶ˆå…¨é¸</button>
                    </div>
                </div>
                <div id="legendsContainer"></div>
            </div>

            <!-- æ­¦å™¨é¸æ“‡ -->
            <div class="settings-section">
                <div class="settings-header">
                    <h2>é¸æ“‡æ­¦å™¨</h2>
                    <div class="btn-group">
                        <button class="btn btn-select-all" onclick="selectAllWeapons(true)">å…¨é¸</button>
                        <button class="btn btn-deselect-all" onclick="selectAllWeapons(false)">å–æ¶ˆå…¨é¸</button>
                    </div>
                </div>
                <div id="weaponsContainer" class="grid"></div>
            </div>
        </div>

        <!-- æŠ½å–æŒ‰éˆ• -->
        <div class="center">
            <button id="spinBtn" class="btn btn-spin" onclick="startSpin()">
                <span id="spinIcon">ğŸ”€</span>
                <span id="spinText">é–‹å§‹æŠ½å–</span>
            </button>
        </div>

        <!-- çµæœé¡¯ç¤º -->
        <div class="results">
            <!-- è‹±é›„çµæœ -->
            <div class="result-card legend">
                <h3>è‹±é›„</h3>
                <div id="legendResult">
                    <div class="placeholder">ç­‰å¾…æŠ½å–</div>
                </div>
            </div>

            <!-- ä¸»æ­¦å™¨çµæœ -->
            <div class="result-card weapon">
                <h3>ä¸»æ­¦å™¨</h3>
                <div id="weapon1Result">
                    <div class="placeholder">ç­‰å¾…æŠ½å–</div>
                </div>
            </div>

            <!-- å‰¯æ­¦å™¨çµæœ -->
            <div class="result-card weapon">
                <h3>å‰¯æ­¦å™¨</h3>
                <div id="weapon2Result">
                    <div class="placeholder">ç­‰å¾…æŠ½å–</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•¸æ“šå®šç¾©
        const legends = {
            çªæ“Š: [
                { name: 'ç­åŠ ç¾…çˆ¾', img: 'https://drop-assets.ea.com/images/59uaaKwAaQVFS2Z5o6JPoM/788687f62d13fdfd3afd71639dcea271/apex-grid-tile-legends-Bangalore.jpg' },
                { name: 'äº¡éˆ', img: 'https://drop-assets.ea.com/images/40px8AHVKdZDFzG0v2IHSl/ae12ef0b2b3aa82d113d06f78885b345/apex-grid-tile-legends-Revenant.jpg' },
                { name: 'è½Ÿå“¥', img: 'https://drop-assets.ea.com/images/1ed5jzmnEE2F3VYADHiAb1/e2a5e038f7fe26d8cd1b6eab882e5247/apex-grid-tile-legends-Fuse.jpg' },
                { name: 'ç˜‹ç‘ªå‰', img: 'https://drop-assets.ea.com/images/4X6EN7HLCByvyHbSVi5I6C/c881852cfd2ca864f578134212a23d55/apex-grid-tile-legends-MadMaggie.jpg' },
                { name: 'å½ˆé“', img: 'https://drop-assets.ea.com/images/2GzrmZx2WNaOzbrdvxf1XB/f7d4fe018c53977c08347bb4f8d92e0d/apex-grid-tile-legends-Ballistic.jpg' }
            ],
            æ•£å…µ: [
                { name: 'æ¢è·¯è€…', img: 'https://drop-assets.ea.com/images/6zanV6x46IQntfmXVJuxWs/08090312744a04dc243b138d0e8fe72a/apex-grid-tile-legends-Pathfinder.jpg' },
                { name: 'æƒ¡éˆ', img: 'https://drop-assets.ea.com/images/4J0UloeNHP6KD21QNrgMcj/cec0cb8949bb3cfe2149a6ca7c2d8a5d/apex-grid-tile-legends-Wraith.jpg' },
                { name: 'å‹•åŠ›å°å­', img: 'https://drop-assets.ea.com/images/15R4OhvkVEF8UgnM2x6iGO/cbfbadf786010c548a900b7cb2cc5960/apex-grid-tile-legends-Octane.jpg' },
                { name: 'åœ°å¹³ç·š', img: 'https://drop-assets.ea.com/images/3wEl6hnRZRfE0kpIhHe16Y/3dc98b90c70516c9a3ee563586c28d63/apex-grid-tile-legends-Horizon.jpg' },
                { name: 'è‰¾è¨±', img: 'https://drop-assets.ea.com/images/4WVk1SMnlzgjk2E3T7f7HC/2db236ad12e23d7a953fa5278b641d5d/apex-grid-tile-legends-Ash.jpg' },
                { name: 'è®Šæ›', img: 'https://drop-assets.ea.com/images/2IfZi30O5KjeTbAHqMGPys/dbd942301f0b723e4f3e30ce27569824/apex-grid-tile-legends-Alter.jpg' }
            ],
            åµå¯Ÿ: [
                { name: 'å°‹è¡€çµçŠ¬', img: 'https://drop-assets.ea.com/images/57Lw4lAodWsiNYTO1zvT6I/ec740d776b1d24172f5c9ed65f6d71af/apex-grid-tile-legends-Bloodhound.jpg' },
                { name: 'æš—ç¢¼å£«', img: 'https://drop-assets.ea.com/images/xnWqynrhqueemWjVw44E9/a39d43a0bf4d58a040f3d1a51815f899/apex-grid-tile-legends-Crypto.jpg?im=Resize=(2560)&q=80' },
                { name: 'ç“¦çˆ¾åŸºé‡Œ', img: 'https://drop-assets.ea.com/images/4FPEvAK1WOqJbMeQhaaGkq/cf3a24ed788f219b79974f20c1ef84f8/apex-grid-tile-legends-Valkyrie.jpg' },
                { name: 'å¸Œçˆ¾', img: 'https://drop-assets.ea.com/images/4Lv7MVV4qMAK4elah1iZoz/10466b756099f26a00aff51cf23bd2f0/apex-grid-tile-legends-Seer.jpg' },
                { name: 'è¬è’‚å¥‡', img: 'https://drop-assets.ea.com/images/6wNJrehz7BfFeKFwWINpCD/e25ce64fad589ca8fee6e4024119cd92/apex-grid-tile-legends-Vantage.jpg' },
                { name: 'é›€å½±', img: 'https://drop-assets.ea.com/images/ZpRorS2mnGb98mIt53sy9/0962732ad880c5f42754776e035316cc/apex-grid-tile-legends-sparrow.jpg' }
            ],
            æ”¯æ´: [
                { name: 'ç›´å¸ƒç¾…é™€', img: 'https://drop-assets.ea.com/images/2uZ8i6QAJcG0twyVOIjC5S/80185d7d5cd8373684bf268c13f07fe0/apex-grid-tile-legends-Gibraltar.jpg' },
                { name: 'ç”Ÿå‘½ç·š', img: 'https://drop-assets.ea.com/images/2CB26KqVrs5AahlXuSCSgl/c1b815b029a81b654a1ea34497cf8926/apex-grid-tile-legends-Lifeline.jpg' },
                { name: 'å¹»è±¡', img: 'https://drop-assets.ea.com/images/JVVgPeCz9D5hCuzdltvTW/8de2e63ef240ab578ff2cab7905918c9/apex-grid-tile-legends-Mirage.jpg' },
                { name: 'ç¾…èŠ­', img: 'https://drop-assets.ea.com/images/5sYrsr2r1tJSjCGM9nwODq/40d430203a315af1900431e26a288619/apex-grid-tile-legends-Loba.jpg?im=Resize=(2560)&q=80' },
                { name: 'ç´å¡ç´¢', img: 'https://drop-assets.ea.com/images/2aqce7tHWCzjdVxcHl0iaS/dd4e76b7c8b007d5bcde01d4e4cae00f/apex-grid-tile-legends-Newcastle.jpg' },
                { name: 'å°ç®¡', img: 'https://drop-assets.ea.com/images/4Ksr2ZX6ImduJHxxeYONtU/277537c176c74b951319f92d86f4698e/apex-grid-tile-legends-Conduit.jpg' }
            ],
            æ§åˆ¶: [
                { name: 'è…è•', img: 'https://drop-assets.ea.com/images/30vsaqTmflB9MEo7GTcgXB/96eb6e78a15a275cd7e85040986985f8/apex-grid-tile-legends-Caustic.jpg' },
                { name: 'è¯ç”Ÿ', img: 'https://drop-assets.ea.com/images/35A7Ebi3AQ5jtXhZlXcgfm/ddc8902fd90e0cf669e9ce4182ab8e1f/apex-grid-tile-legends-Wattson.jpg' },
                { name: 'è˜­ä¼¯ç‰¹', img: 'https://drop-assets.ea.com/images/21QdZAxCn7qZWCLNPR4X3C/ec7c5e4cbf7a2aad48702b4fb4103878/apex-grid-tile-legends-Rampart.jpg' },
                { name: 'å‚¬åŒ–å§¬', img: 'https://drop-assets.ea.com/images/I01amfukfvzrqbSSg1xQB/6147400ff2102b3ddd5f5c931a374be8/apex-grid-tile-legends-Catalyst.jpg' }
            ]
        };

        const weapons = [
            { name: 'R-301 å¡è³“æ§', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/f/f1/R-301_Carbine.png' },
            { name: 'VK-47 å¹³è¡Œ', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/f/f1/VK-47_Flatline.png' },
            { name: 'æ¼¢å§†æ´›å…‹', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/7/74/Hemlok_Burst_AR.png' },
            { name: 'å“ˆæŸå…‹', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/e/ec/HAVOC_Rifle.png' },
            { name: 'å¾©ä»‡å¥³ç¥', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/b/b8/Nemesis_Burst_AR.png' },
            { name: 'R-99', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/d/d5/R-99_SMG.png' },
            { name: 'å°å¹«æ‰‹', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/e/e9/Alternator_SMG.png' },
            { name: 'é›»èƒ½è¡é‹’æ§', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/6/60/Volt_SMG.png' },
            { name: 'C.A.R.', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/1/13/C.A.R._SMG.png' },
            { name: 'çµç¸', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/b/bf/Prowler_Burst_PDW.png' },
            { name: 'å™´ç«æ§', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/f/f2/M600_Spitfire.png' },
            { name: 'å°ˆæ³¨è¼•æ©Ÿæ§', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/8/8c/Devotion_LMG.png' },
            { name: 'æš´èµ°', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/2/20/Rampage_LMG.png' },
            { name: 'L-Star', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/0/01/L-STAR_EMG.png' },
            { name: 'G7 åµæŸ¥æ§', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/e/eb/G7_Scout.png' },
            { name: '30-30 é€£ç™¼æ§', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/8/86/30-30_Repeater.png' },
            { name: 'ä¸‰é‡æ“Š', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/d/d9/Triple_Take.png' },
            { name: 'æ³¢è³½å…‹è¤‡åˆå¼“', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/0/02/Bocek_Compound_Bow.png' },
            { name: 'é•·å¼“', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/4/46/Longbow_DMR.png' },
            { name: 'å……èƒ½æ­¥æ§', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/2/2b/Charge_Rifle.png' },
            { name: 'å“¨å…µ', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/9/91/Sentinel.png' },
            { name: 'å…‹èŠä¼¯', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/f/f5/Kraber_.50-Cal_Sniper.png' },
            { name: 'EVA-8', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/9/97/EVA-8_Auto.png' },
            { name: 'å’Œå¹³ä½¿è€…', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/6/64/Peacekeeper.png' },
            { name: 'æ•–çŠ¬', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/c/c9/Mastiff_Shotgun.png' },
            { name: 'è«ä¸‰æ¯”å…‹', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/a/ae/Mozambique_Shotgun.png' },
            { name: 'P2020', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/c/c1/P2020.png' },
            { name: 'RE-45', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/2/25/RE-45_Auto.png' },
            { name: 'å°å¹«æ‰‹æ‰‹æ§', img: 'https://static.wikia.nocookie.net/apexlegends_gamepedia_en/images/0/09/Wingman.png' }
        ];

        // ç‹€æ…‹ç®¡ç†
        let enabledLegends = {};
        let enabledWeapons = {};
        let isSpinning = false;
        let audioContext = null;

        // åˆå§‹åŒ–
        function init() {
            // åˆå§‹åŒ–éŸ³é »
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // å…¨éƒ¨å•Ÿç”¨
            Object.keys(legends).forEach(role => {
                legends[role].forEach(legend => {
                    enabledLegends[legend.name] = true;
                });
            });
            weapons.forEach(weapon => {
                enabledWeapons[weapon.name] = true;
            });

            // æ¸²æŸ“UI
            renderLegends();
            renderWeapons();
        }

        // æ¸²æŸ“è‹±é›„é¸æ“‡
        function renderLegends() {
            const container = document.getElementById('legendsContainer');
            container.innerHTML = '';

            Object.keys(legends).forEach(role => {
                const roleDiv = document.createElement('div');
                roleDiv.className = 'role-group';
                
                const roleTitle = document.createElement('div');
                roleTitle.className = 'role-title';
                roleTitle.textContent = role;
                roleDiv.appendChild(roleTitle);

                const grid = document.createElement('div');
                grid.className = 'grid';

                legends[role].forEach(legend => {
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    if (enabledLegends[legend.name]) {
                        card.classList.add('enabled');
                    }
                    card.onclick = () => toggleLegend(legend.name);

                    card.innerHTML = `
                        <img src="${legend.img}" alt="${legend.name}">
                        <p>${legend.name}</p>
                    `;

                    grid.appendChild(card);
                });

                roleDiv.appendChild(grid);
                container.appendChild(roleDiv);
            });
        }

        // æ¸²æŸ“æ­¦å™¨é¸æ“‡
        function renderWeapons() {
            const container = document.getElementById('weaponsContainer');
            container.innerHTML = '';

            weapons.forEach(weapon => {
                const card = document.createElement('div');
                card.className = 'item-card weapon-card';
                if (enabledWeapons[weapon.name]) {
                    card.classList.add('enabled');
                }
                card.onclick = () => toggleWeapon(weapon.name);

                card.innerHTML = `
                    <img src="${weapon.img}" alt="${weapon.name}">
                    <p>${weapon.name}</p>
                `;

                container.appendChild(card);
            });
        }

        // åˆ‡æ›è¨­å®šé¢æ¿
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            const text = document.getElementById('settingsText');
            panel.classList.toggle('active');
            text.textContent = panel.classList.contains('active') ? 'é—œé–‰è¨­å®š' : 'é–‹å•Ÿè¨­å®š';
        }

        // åˆ‡æ›è‹±é›„
        function toggleLegend(name) {
            enabledLegends[name] = !enabledLegends[name];
            renderLegends();
        }

        // åˆ‡æ›æ­¦å™¨
        function toggleWeapon(name) {
            enabledWeapons[name] = !enabledWeapons[name];
            renderWeapons();
        }

        // å…¨é¸/å–æ¶ˆå…¨é¸è‹±é›„
        function selectAllLegends(enable) {
            Object.keys(legends).forEach(role => {
                legends[role].forEach(legend => {
                    enabledLegends[legend.name] = enable;
                });
            });
            renderLegends();
        }

        // å…¨é¸/å–æ¶ˆå…¨é¸æ­¦å™¨
        function selectAllWeapons(enable) {
            weapons.forEach(weapon => {
                enabledWeapons[weapon.name] = enable;
            });
            renderWeapons();
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playTickSound() {
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(1500, audioContext.currentTime);

            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.03);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.03);
        }

        // è½‰ç›¤å‹•ç•«
        function spinWheel(items, duration, resultId) {
            return new Promise((resolve) => {
                const startTime = Date.now();
                let currentIndex = 0;
                let lastTickTime = 0;
                const resultDiv = document.getElementById(resultId);

                function animate() {
                    const elapsed = Date.now() - startTime;
                    const progress = elapsed / duration;

                    if (progress >= 1) {
                        resolve(items[currentIndex]);
                        return;
                    }

                    const speed = Math.max(30, 300 * (1 - progress));

                    if (elapsed - lastTickTime > speed) {
                        currentIndex = (currentIndex + 1) % items.length;
                        const item = items[currentIndex];
                        
                        const isWeapon = resultId.includes('weapon');
                        resultDiv.innerHTML = `
                            <div class="result-display spinning">
                                <img src="${item.img}" alt="${item.name}">
                                <p>${item.name}</p>
                            </div>
                        `;
                        
                        playTickSound();
                        lastTickTime = elapsed;
                    }

                    requestAnimationFrame(animate);
                }

                animate();
            });
        }

        // é–‹å§‹æŠ½å–
        async function startSpin() {
            if (isSpinning) return;

            // ç²å–å¯ç”¨é …ç›®
            const availableLegends = [];
            Object.keys(legends).forEach(role => {
                legends[role].forEach(legend => {
                    if (enabledLegends[legend.name]) {
                        availableLegends.push(legend);
                    }
                });
            });

            const availableWeapons = weapons.filter(w => enabledWeapons[w.name]);

            if (availableLegends.length === 0 || availableWeapons.length < 2) {
                alert('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹è‹±é›„å’Œå…©æŠŠæ­¦å™¨ï¼');
                return;
            }

            // è¨­å®šæŒ‰éˆ•ç‹€æ…‹
            isSpinning = true;
            const btn = document.getElementById('spinBtn');
            const icon = document.getElementById('spinIcon');
            const text = document.getElementById('spinText');
            btn.disabled = true;
            icon.classList.add('spinning-icon');
            text.textContent = 'æŠ½å–ä¸­...';

            // é‡ç½®çµæœé¡¯ç¤º
            document.getElementById('legendResult').innerHTML = '<div class="placeholder">æŠ½å–ä¸­...</div>';
            document.getElementById('weapon1Result').innerHTML = '<div class="placeholder">æŠ½å–ä¸­...</div>';
            document.getElementById('weapon2Result').innerHTML = '<div class="placeholder">æŠ½å–ä¸­...</div>';

            // åŒæ™‚æ—‹è½‰ä¸‰å€‹è½‰ç›¤
            await Promise.all([
                spinWheel(availableLegends, 3000, 'legendResult'),
                spinWheel(availableWeapons, 3500, 'weapon1Result'),
                spinWheel(availableWeapons, 4000, 'weapon2Result')
            ]);

            // ç§»é™¤æ—‹è½‰æ•ˆæœ
            document.querySelectorAll('.result-display').forEach(el => {
                el.classList.remove('spinning');
            });

            // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
            isSpinning = false;
            btn.disabled = false;
            icon.classList.remove('spinning-icon');
            text.textContent = 'é–‹å§‹æŠ½å–';
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
